<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroMed AI - Advanced Healthcare Assistant</title>
    <link rel="icon" href="/assets/logo_rounded.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Enhanced CSS Variables for Perfect Color Harmony */
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --accent: #06b6d4;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --border-primary: #e2e8f0;
            --border-secondary: #cbd5e1;
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.1);
            --shadow-heavy: rgba(0, 0, 0, 0.25);
            --glow-primary: rgba(37, 99, 235, 0.3);
            --glow-secondary: rgba(124, 58, 237, 0.3);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-light: #60a5fa;
            --primary-dark: #2563eb;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-primary: #334155;
            --border-secondary: #475569;
            --shadow-light: rgba(0, 0, 0, 0.3);
            --shadow-medium: rgba(0, 0, 0, 0.4);
            --shadow-heavy: rgba(0, 0, 0, 0.6);
            --glow-primary: rgba(59, 130, 246, 0.4);
            --glow-secondary: rgba(139, 92, 246, 0.4);
            --glass-bg: rgba(30, 41, 59, 0.3);
            --glass-border: rgba(148, 163, 184, 0.1);
        }

        /* Neon Cyan */
        [data-theme="neon-cyan"] {
            --primary: #00ffff;
            --primary-light: #4dffff;
            --primary-dark: #00cccc;
            --secondary: #0099ff;
            --accent: #66ffff;
            --bg-primary: #0a0e1a;
            --bg-secondary: #0f1419;
            --bg-tertiary: #1a2332;
            --text-primary: #e6ffff;
            --text-secondary: #b3ffff;
            --text-tertiary: #80ffff;
            --border-primary: #004d4d;
            --border-secondary: #006666;
            --shadow-light: rgba(0, 255, 255, 0.1);
            --shadow-medium: rgba(0, 255, 255, 0.2);
            --shadow-heavy: rgba(0, 255, 255, 0.4);
            --glow-primary: rgba(0, 255, 255, 0.6);
            --glow-secondary: rgba(0, 153, 255, 0.4);
            --glass-bg: rgba(0, 255, 255, 0.05);
            --glass-border: rgba(0, 255, 255, 0.2);
        }

        /* Neon Magenta */
        [data-theme="neon-magenta"] {
            --primary: #ff0080;
            --primary-light: #ff4da6;
            --primary-dark: #cc0066;
            --secondary: #ff0040;
            --accent: #ff66b3;
            --bg-primary: #1a0a14;
            --bg-secondary: #1f0f19;
            --bg-tertiary: #321a2b;
            --text-primary: #ffe6f2;
            --text-secondary: #ffb3d9;
            --text-tertiary: #ff80c0;
            --border-primary: #4d001a;
            --border-secondary: #660026;
            --shadow-light: rgba(255, 0, 128, 0.1);
            --shadow-medium: rgba(255, 0, 128, 0.2);
            --shadow-heavy: rgba(255, 0, 128, 0.4);
            --glow-primary: rgba(255, 0, 128, 0.6);
            --glow-secondary: rgba(255, 0, 64, 0.4);
            --glass-bg: rgba(255, 0, 128, 0.05);
            --glass-border: rgba(255, 0, 128, 0.2);
        }

        /* Neon Green */
        [data-theme="neon-green"] {
            --primary: #00ff41;
            --primary-light: #4dff70;
            --primary-dark: #00cc33;
            --secondary: #00ff80;
            --accent: #66ffaa;
            --bg-primary: #0a1a0f;
            --bg-secondary: #0f1f14;
            --bg-tertiary: #1a3223;
            --text-primary: #e6ffe9;
            --text-secondary: #b3ffbf;
            --text-tertiary: #80ff95;
            --border-primary: #004d1a;
            --border-secondary: #006626;
            --shadow-light: rgba(0, 255, 65, 0.1);
            --shadow-medium: rgba(0, 255, 65, 0.2);
            --shadow-heavy: rgba(0, 255, 65, 0.4);
            --glow-primary: rgba(0, 255, 65, 0.6);
            --glow-secondary: rgba(0, 255, 128, 0.4);
            --glass-bg: rgba(0, 255, 65, 0.05);
            --glass-border: rgba(0, 255, 65, 0.2);
        }

        /* Neon Purple */
        [data-theme="neon-purple"] {
            --primary: #8000ff;
            --primary-light: #a64dff;
            --primary-dark: #6600cc;
            --secondary: #b300ff;
            --accent: #d966ff;
            --bg-primary: #140a1a;
            --bg-secondary: #190f1f;
            --bg-tertiary: #2b1a32;
            --text-primary: #f2e6ff;
            --text-secondary: #d9b3ff;
            --text-tertiary: #c080ff;
            --border-primary: #1a004d;
            --border-secondary: #260066;
            --shadow-light: rgba(128, 0, 255, 0.1);
            --shadow-medium: rgba(128, 0, 255, 0.2);
            --shadow-heavy: rgba(128, 0, 255, 0.4);
            --glow-primary: rgba(128, 0, 255, 0.6);
            --glow-secondary: rgba(179, 0, 255, 0.4);
            --glass-bg: rgba(128, 0, 255, 0.05);
            --glass-border: rgba(128, 0, 255, 0.2);
        }

        /* Neon Orange */
        [data-theme="neon-orange"] {
            --primary: #ff6600;
            --primary-light: #ff8533;
            --primary-dark: #cc5200;
            --secondary: #ff9900;
            --accent: #ffb366;
            --bg-primary: #1a0f0a;
            --bg-secondary: #1f140f;
            --bg-tertiary: #32251a;
            --text-primary: #fff2e6;
            --text-secondary: #ffd9b3;
            --text-tertiary: #ffbf80;
            --border-primary: #4d1a00;
            --border-secondary: #662600;
            --shadow-light: rgba(255, 102, 0, 0.1);
            --shadow-medium: rgba(255, 102, 0, 0.2);
            --shadow-heavy: rgba(255, 102, 0, 0.4);
            --glow-primary: rgba(255, 102, 0, 0.6);
            --glow-secondary: rgba(255, 153, 0, 0.4);
            --glass-bg: rgba(255, 102, 0, 0.05);
            --glass-border: rgba(255, 102, 0, 0.2);
        }

        /* Milky Way Galaxy Theme */
        [data-theme="milky-way"] {
            --primary: #9333ea;
            --primary-light: #a855f7;
            --primary-dark: #7c3aed;
            --secondary: #3b82f6;
            --accent: #06b6d4;
            --bg-primary: #0c0a1a;
            --bg-secondary: #1a1625;
            --bg-tertiary: #2d2438;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-primary: #4c1d95;
            --border-secondary: #6d28d9;
            --shadow-light: rgba(147, 51, 234, 0.1);
            --shadow-medium: rgba(147, 51, 234, 0.2);
            --shadow-heavy: rgba(147, 51, 234, 0.4);
            --glow-primary: rgba(147, 51, 234, 0.6);
            --glow-secondary: rgba(59, 130, 246, 0.4);
            --glass-bg: rgba(147, 51, 234, 0.05);
            --glass-border: rgba(147, 51, 234, 0.2);
        }

        /* Cosmic Blue Theme */
        [data-theme="cosmic-blue"] {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --primary-dark: #1e3a8a;
            --secondary: #6366f1;
            --accent: #8b5cf6;
            --bg-primary: #0a0f1c;
            --bg-secondary: #111827;
            --bg-tertiary: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --border-primary: #1e3a8a;
            --border-secondary: #3730a3;
            --shadow-light: rgba(30, 64, 175, 0.1);
            --shadow-medium: rgba(30, 64, 175, 0.2);
            --shadow-heavy: rgba(30, 64, 175, 0.4);
            --glow-primary: rgba(30, 64, 175, 0.6);
            --glow-secondary: rgba(99, 102, 241, 0.4);
            --glass-bg: rgba(30, 64, 175, 0.05);
            --glass-border: rgba(30, 64, 175, 0.2);
        }

        /* Solar Flare Theme */
        [data-theme="solar-flare"] {
            --primary: #dc2626;
            --primary-light: #ef4444;
            --primary-dark: #b91c1c;
            --secondary: #f59e0b;
            --accent: #f97316;
            --bg-primary: #1a0a0a;
            --bg-secondary: #2d1b1b;
            --bg-tertiary: #3f2626;
            --text-primary: #fef2f2;
            --text-secondary: #fecaca;
            --text-tertiary: #fca5a5;
            --border-primary: #7f1d1d;
            --border-secondary: #991b1b;
            --shadow-light: rgba(220, 38, 38, 0.1);
            --shadow-medium: rgba(220, 38, 38, 0.2);
            --shadow-heavy: rgba(220, 38, 38, 0.4);
            --glow-primary: rgba(220, 38, 38, 0.6);
            --glow-secondary: rgba(245, 158, 11, 0.4);
            --glass-bg: rgba(220, 38, 38, 0.05);
            --glass-border: rgba(220, 38, 38, 0.2);
        }

        /* Aurora Theme */
        [data-theme="aurora"] {
            --primary: #10b981;
            --primary-light: #34d399;
            --primary-dark: #059669;
            --secondary: #06b6d4;
            --accent: #8b5cf6;
            --bg-primary: #0a1a14;
            --bg-secondary: #0f2419;
            --bg-tertiary: #1a3d2e;
            --text-primary: #ecfdf5;
            --text-secondary: #a7f3d0;
            --text-tertiary: #6ee7b7;
            --border-primary: #065f46;
            --border-secondary: #047857;
            --shadow-light: rgba(16, 185, 129, 0.1);
            --shadow-medium: rgba(16, 185, 129, 0.2);
            --shadow-heavy: rgba(16, 185, 129, 0.4);
            --glow-primary: rgba(16, 185, 129, 0.6);
            --glow-secondary: rgba(6, 182, 212, 0.4);
            --glass-bg: rgba(16, 185, 129, 0.05);
            --glass-border: rgba(16, 185, 129, 0.2);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            background: 
                radial-gradient(circle at 20% 80%, var(--glow-primary) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, var(--glow-secondary) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, var(--accent) 0%, transparent 70%);
            animation: bgShift 20s ease-in-out infinite;
        }

        /* Special backgrounds for space themes */
        [data-theme="milky-way"] .bg-animation {
            background: 
                radial-gradient(circle at 20% 80%, var(--glow-primary) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, var(--glow-secondary) 0%, transparent 50%),
                radial-gradient(circle at 60% 30%, rgba(147, 51, 234, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 30% 70%, rgba(59, 130, 246, 0.2) 0%, transparent 60%);
        }

        [data-theme="cosmic-blue"] .bg-animation {
            background: 
                radial-gradient(circle at 25% 75%, var(--glow-primary) 0%, transparent 45%),
                radial-gradient(circle at 75% 25%, var(--glow-secondary) 0%, transparent 45%),
                radial-gradient(circle at 50% 50%, rgba(30, 64, 175, 0.2) 0%, transparent 70%);
        }

        @keyframes bgShift {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary);
            border-radius: 50%;
            animation: float 15s linear infinite;
            opacity: 0.6;
        }

        /* Special particles for space themes */
        [data-theme="milky-way"] .particle {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            box-shadow: 0 0 6px var(--primary);
        }

        [data-theme="cosmic-blue"] .particle {
            background: var(--accent);
            box-shadow: 0 0 4px var(--accent);
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }

        /* Glassmorphism Effects */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px var(--shadow-light);
        }

        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-primary);
            height: 80px;
            flex-shrink: 0;
            position: relative;
            z-index: 100;
            box-shadow: 0 4px 20px var(--shadow-light);
        }

        [data-theme^="neon"] .app-header,
        [data-theme="milky-way"] .app-header,
        [data-theme="cosmic-blue"] .app-header,
        [data-theme="solar-flare"] .app-header,
        [data-theme="aurora"] .app-header {
            box-shadow: 0 4px 30px var(--glow-primary);
            border-bottom-color: var(--primary);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 12px;
            border-radius: 12px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 20px;
            position: relative;
            overflow: hidden;
        }

        .sidebar-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--glow-primary), transparent);
            transition: left 0.5s;
        }

        .sidebar-toggle:hover::before {
            left: 100%;
        }

        .sidebar-toggle:hover {
            background: var(--glass-bg);
            color: var(--primary);
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .sidebar-toggle.active {
            color: var(--primary);
            transform: rotate(90deg);
            background: var(--glass-bg);
        }

        .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            font-size: 20px;
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: logoShine 3s ease-in-out infinite;
        }

        @keyframes logoShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }

        [data-theme^="neon"] .logo,
        [data-theme="milky-way"] .logo,
        [data-theme="cosmic-blue"] .logo,
        [data-theme="solar-flare"] .logo,
        [data-theme="aurora"] .logo {
            box-shadow: 0 0 30px var(--glow-primary);
            animation: logoPulse 2s ease-in-out infinite;
        }

        @keyframes logoPulse {
            0%, 100% { 
                box-shadow: 0 0 30px var(--glow-primary);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 50px var(--glow-primary), 0 0 70px var(--glow-secondary);
                transform: scale(1.05);
            }
        }

        .app-title {
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        [data-theme^="neon"] .app-title,
        [data-theme="milky-way"] .app-title,
        [data-theme="cosmic-blue"] .app-title,
        [data-theme="solar-flare"] .app-title,
        [data-theme="aurora"] .app-title {
            text-shadow: 0 0 20px var(--primary);
            -webkit-text-fill-color: var(--primary);
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px var(--primary); }
            50% { text-shadow: 0 0 30px var(--primary), 0 0 40px var(--secondary); }
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--glass-bg);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid var(--border-primary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: statusPulse 2s ease-in-out infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .action-btn {
            background: var(--glass-bg);
            border: 1px solid var(--border-primary);
            color: var(--text-secondary);
            cursor: pointer;
            padding: 12px;
            border-radius: 12px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, var(--glow-primary) 0%, transparent 70%);
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
        }

        .action-btn:hover::before {
            width: 100px;
            height: 100px;
        }

        .action-btn:hover {
            color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--glow-primary);
            border-color: var(--primary);
        }

        /* Sidebar */
        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .sidebar {
            width: 320px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
            padding: 24px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
            z-index: 50;
            transform: translateX(0);
        }

        [data-theme^="neon"] .sidebar,
        [data-theme="milky-way"] .sidebar,
        [data-theme="cosmic-blue"] .sidebar,
        [data-theme="solar-flare"] .sidebar,
        [data-theme="aurora"] .sidebar {
            border-right-color: var(--primary);
            box-shadow: 8px 0 30px var(--glow-primary);
        }

        .sidebar.collapsed {
            width: 80px;
            padding: 24px 16px;
        }

        .sidebar.collapsed .sidebar-content {
            opacity: 0;
            pointer-events: none;
        }

        .sidebar.collapsed .new-chat-btn span,
        .sidebar.collapsed .history-title,
        .sidebar.collapsed .history-item span,
        .sidebar.collapsed .ai-stats {
            display: none;
        }

        .sidebar-content {
            transition: opacity 0.3s ease;
        }

        .new-chat-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .new-chat-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .new-chat-btn:hover::before {
            left: 100%;
        }

        .new-chat-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px var(--glow-primary);
        }

        [data-theme^="neon"] .new-chat-btn,
        [data-theme="milky-way"] .new-chat-btn,
        [data-theme="cosmic-blue"] .new-chat-btn,
        [data-theme="solar-flare"] .new-chat-btn,
        [data-theme="aurora"] .new-chat-btn {
            box-shadow: 0 8px 30px var(--glow-primary);
        }

        .ai-stats {
            background: var(--glass-bg);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .ai-stats-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            font-family: 'Orbitron', monospace;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .history-title {
            font-size: 16px;
            color: var(--text-secondary);
            padding: 12px 0;
            margin-top: 8px;
            border-bottom: 1px solid var(--border-primary);
            font-weight: 600;
            font-family: 'Orbitron', monospace;
        }

        [data-theme^="neon"] .history-title,
        [data-theme="milky-way"] .history-title,
        [data-theme="cosmic-blue"] .history-title,
        [data-theme="solar-flare"] .history-title,
        [data-theme="aurora"] .history-title {
            text-shadow: 0 0 10px var(--primary);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            margin-top: 16px;
        }

        .history-item {
            padding: 16px;
            border-radius: 16px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 8px;
            color: var(--text-primary);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
        }

        .history-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--glow-primary), transparent);
            transition: left 0.5s;
            opacity: 0.1;
        }

        .history-item:hover::before {
            left: 100%;
        }

        .history-item:hover {
            background: var(--glass-bg);
            transform: translateX(8px);
            border-color: var(--primary);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .history-item.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .history-item i {
            font-size: 16px;
            width: 20px;
            opacity: 0.8;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-header {
            padding: 16px 32px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            font-size: 18px;
        }

        .chat-actions {
            display: flex;
            gap: 12px;
        }

        .chat-action-btn {
            padding: 8px 16px;
            background: var(--glass-bg);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .chat-action-btn:hover {
            color: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 4px 15px var(--glow-primary);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            display: flex;
            flex-direction: column;
            gap: 32px;
            position: relative;
        }

        .message {
            display: flex;
            gap: 20px;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            animation: messageSlide 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes messageSlide {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            font-family: 'Orbitron', monospace;
            position: relative;
            overflow: hidden;
        }

        .avatar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: avatarShine 4s ease-in-out infinite;
        }

        @keyframes avatarShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }

        .user .avatar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: 2px solid var(--primary);
        }

        [data-theme^="neon"] .user .avatar,
        [data-theme="milky-way"] .user .avatar,
        [data-theme="cosmic-blue"] .user .avatar,
        [data-theme="solar-flare"] .user .avatar,
        [data-theme="aurora"] .user .avatar {
            box-shadow: 0 0 25px var(--glow-primary);
        }

        .ai .avatar {
            background: var(--glass-bg);
            color: var(--primary);
            border: 2px solid var(--primary);
            backdrop-filter: blur(20px);
        }

        [data-theme^="neon"] .ai .avatar,
        [data-theme="milky-way"] .ai .avatar,
        [data-theme="cosmic-blue"] .ai .avatar,
        [data-theme="solar-flare"] .ai .avatar,
        [data-theme="aurora"] .ai .avatar {
            box-shadow: 0 0 25px var(--glow-primary);
        }

        .message-content {
            flex: 1;
        }

        .username {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 12px;
            font-family: 'Orbitron', monospace;
        }

        [data-theme^="neon"] .username,
        [data-theme="milky-way"] .username,
        [data-theme="cosmic-blue"] .username,
        [data-theme="solar-flare"] .username,
        [data-theme="aurora"] .username {
            text-shadow: 0 0 10px var(--primary);
        }

        .message-text {
            line-height: 1.7;
            font-size: 16px;
            padding: 24px 28px;
            border-radius: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            white-space: pre-wrap;
            position: relative;
            border: 1px solid var(--border-primary);
            box-shadow: 0 8px 32px var(--shadow-light);
        }

        [data-theme^="neon"] .message-text,
        [data-theme="milky-way"] .message-text,
        [data-theme="cosmic-blue"] .message-text,
        [data-theme="solar-flare"] .message-text,
        [data-theme="aurora"] .message-text {
            border-color: var(--primary);
            box-shadow: 0 8px 32px var(--glow-primary);
        }

        .ai .message-text {
            background: var(--bg-secondary);
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 16px 0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: typingBounce 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .message-actions {
            display: flex;
            gap: 16px;
            margin-top: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-icon {
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .action-icon:hover {
            color: var(--primary);
            background: var(--glass-bg);
            transform: scale(1.1);
        }

        [data-theme^="neon"] .action-icon:hover,
        [data-theme="milky-way"] .action-icon:hover,
        [data-theme="cosmic-blue"] .action-icon:hover,
        [data-theme="solar-flare"] .action-icon:hover,
        [data-theme="aurora"] .action-icon:hover {
            text-shadow: 0 0 15px var(--primary);
            box-shadow: 0 0 15px var(--glow-primary);
        }

        .like-count {
            font-size: 12px;
            font-weight: 600;
        }

        .action-icon.liked {
            color: var(--primary);
        }

        .action-icon.disliked {
            color: var(--error);
        }

        /* Input Area */
        .input-container {
            padding: 24px 32px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-primary);
            position: relative;
        }

        [data-theme^="neon"] .input-container,
        [data-theme="milky-way"] .input-container,
        [data-theme="cosmic-blue"] .input-container,
        [data-theme="solar-flare"] .input-container,
        [data-theme="aurora"] .input-container {
            border-top-color: var(--primary);
            box-shadow: 0 -8px 30px var(--glow-primary);
        }

        .input-box {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        .text-input {
            width: 100%;
            border: 2px solid var(--border-primary);
            border-radius: 24px;
            padding: 20px 28px;
            padding-right: 160px;
            font-size: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            resize: none;
            height: 64px;
            max-height: 200px;
            overflow-y: auto;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Exo 2', sans-serif;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--glow-primary);
            transform: translateY(-2px);
        }

        [data-theme^="neon"] .text-input,
        [data-theme="milky-way"] .text-input,
        [data-theme="cosmic-blue"] .text-input,
        [data-theme="solar-flare"] .text-input,
        [data-theme="aurora"] .text-input {
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--glow-primary);
        }

        [data-theme^="neon"] .text-input:focus,
        [data-theme="milky-way"] .text-input:focus,
        [data-theme="cosmic-blue"] .text-input:focus,
        [data-theme="solar-flare"] .text-input:focus,
        [data-theme="aurora"] .text-input:focus {
            box-shadow: 0 0 30px var(--glow-primary);
        }

        .input-actions {
            position: absolute;
            right: 20px;
            bottom: 16px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .file-btn, .voice-btn {
            background: var(--glass-bg);
            border: 1px solid var(--border-primary);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .file-btn::before, .voice-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, var(--glow-primary) 0%, transparent 70%);
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
        }

        .file-btn:hover::before, .voice-btn:hover::before {
            width: 80px;
            height: 80px;
        }

        .file-btn:hover, .voice-btn:hover {
            color: var(--primary);
            border-color: var(--primary);
            transform: scale(1.1);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .send-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .send-btn:hover::before {
            left: 100%;
        }

        .send-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 12px 35px var(--glow-primary);
        }

        [data-theme^="neon"] .send-btn,
        [data-theme="milky-way"] .send-btn,
        [data-theme="cosmic-blue"] .send-btn,
        [data-theme="solar-flare"] .send-btn,
        [data-theme="aurora"] .send-btn {
            box-shadow: 0 8px 30px var(--glow-primary);
        }

        .send-btn:disabled {
            background: var(--text-tertiary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Welcome Section */
        .welcome-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
            padding: 60px 32px;
        }

        .welcome-title {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 24px;
            font-family: 'Orbitron', monospace;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        [data-theme^="neon"] .welcome-title,
        [data-theme="milky-way"] .welcome-title,
        [data-theme="cosmic-blue"] .welcome-title,
        [data-theme="solar-flare"] .welcome-title,
        [data-theme="aurora"] .welcome-title {
            text-shadow: 0 0 30px var(--primary);
            -webkit-text-fill-color: var(--primary);
            animation: titlePulse 3s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { 
                text-shadow: 0 0 30px var(--primary);
                transform: scale(1);
            }
            50% { 
                text-shadow: 0 0 50px var(--primary), 0 0 70px var(--secondary);
                transform: scale(1.02);
            }
        }

        .welcome-subtitle {
            font-size: 20px;
            color: var(--text-secondary);
            margin-bottom: 48px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            max-width: 700px;
            margin: 0 auto;
        }

        .capability-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--border-primary);
            border-radius: 20px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .capability-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--glow-primary), transparent);
            transition: left 0.6s;
            opacity: 0.1;
        }

        .capability-card:hover::before {
            left: 100%;
        }

        .capability-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 20px 50px var(--glow-primary);
            border-color: var(--primary);
        }

        [data-theme^="neon"] .capability-card,
        [data-theme="milky-way"] .capability-card,
        [data-theme="cosmic-blue"] .capability-card,
        [data-theme="solar-flare"] .capability-card,
        [data-theme="aurora"] .capability-card {
            border-color: var(--primary);
            box-shadow: 0 8px 30px var(--glow-primary);
        }

        .capability-icon {
            font-size: 36px;
            color: var(--primary);
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .capability-card:hover .capability-icon {
            transform: scale(1.2) rotate(5deg);
        }

        [data-theme^="neon"] .capability-icon,
        [data-theme="milky-way"] .capability-icon,
        [data-theme="cosmic-blue"] .capability-icon,
        [data-theme="solar-flare"] .capability-icon,
        [data-theme="aurora"] .capability-icon {
            text-shadow: 0 0 20px var(--primary);
        }

        .capability-title {
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 18px;
            font-family: 'Orbitron', monospace;
        }

        .capability-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Settings Modal */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .settings-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .settings-content {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 40px;
            width: 90%;
            max-width: 700px;
            border: 2px solid var(--border-primary);
            transform: scale(0.8) translateY(50px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px var(--shadow-heavy);
            max-height: 80vh;
            overflow-y: auto;
        }

        [data-theme^="neon"] .settings-content,
        [data-theme="milky-way"] .settings-content,
        [data-theme="cosmic-blue"] .settings-content,
        [data-theme="solar-flare"] .settings-content,
        [data-theme="aurora"] .settings-content {
            border-color: var(--primary);
            box-shadow: 0 20px 60px var(--glow-primary);
        }

        .settings-modal.active .settings-content {
            transform: scale(1) translateY(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .settings-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'Orbitron', monospace;
        }

        [data-theme^="neon"] .settings-title,
        [data-theme="milky-way"] .settings-title,
        [data-theme="cosmic-blue"] .settings-title,
        [data-theme="solar-flare"] .settings-title,
        [data-theme="aurora"] .settings-title {
            text-shadow: 0 0 15px var(--primary);
        }

        .close-btn {
            background: var(--glass-bg);
            border: 1px solid var(--border-primary);
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 12px;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--primary);
            border-color: var(--primary);
            transform: scale(1.1);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .setting-group {
            margin-bottom: 32px;
        }

        .setting-label {
            display: block;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
            font-size: 18px;
            font-family: 'Orbitron', monospace;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .theme-option {
            padding: 16px;
            border: 2px solid var(--border-primary);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            background: var(--bg-secondary);
            position: relative;
            overflow: hidden;
        }

        .theme-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--glow-primary), transparent);
            transition: left 0.5s;
            opacity: 0.1;
        }

        .theme-option:hover::before {
            left: 100%;
        }

        .theme-option:hover {
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .theme-option.active {
            border-color: var(--primary);
            background: var(--glass-bg);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .theme-preview {
            width: 100%;
            height: 50px;
            border-radius: 12px;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .theme-name {
            font-size: 14px;
            font-weight: 600;
            font-family: 'Orbitron', monospace;
        }

        /* Theme Previews */
        .theme-option[data-theme="light"] .theme-preview {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0, #cbd5e1);
        }

        .theme-option[data-theme="dark"] .theme-preview {
            background: linear-gradient(135deg, #0f172a, #334155, #475569);
        }

        .theme-option[data-theme="neon-cyan"] .theme-preview {
            background: linear-gradient(135deg, #0a0e1a, #00ffff, #4dffff);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        .theme-option[data-theme="neon-magenta"] .theme-preview {
            background: linear-gradient(135deg, #1a0a14, #ff0080, #ff4da6);
            box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        .theme-option[data-theme="neon-green"] .theme-preview {
            background: linear-gradient(135deg, #0a1a0f, #00ff41, #4dff70);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        .theme-option[data-theme="neon-purple"] .theme-preview {
            background: linear-gradient(135deg, #140a1a, #8000ff, #a64dff);
            box-shadow: 0 0 20px rgba(128, 0, 255, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        .theme-option[data-theme="neon-orange"] .theme-preview {
            background: linear-gradient(135deg, #1a0f0a, #ff6600, #ff8533);
            box-shadow: 0 0 20px rgba(255, 102, 0, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        .theme-option[data-theme="milky-way"] .theme-preview {
            background: linear-gradient(135deg, #0c0a1a, #9333ea, #3b82f6);
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        .theme-option[data-theme="cosmic-blue"] .theme-preview {
            background: linear-gradient(135deg, #0a0f1c, #1e40af, #6366f1);
            box-shadow: 0 0 20px rgba(30, 64, 175, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        .theme-option[data-theme="solar-flare"] .theme-preview {
            background: linear-gradient(135deg, #1a0a0a, #dc2626, #f59e0b);
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        .theme-option[data-theme="aurora"] .theme-preview {
            background: linear-gradient(135deg, #0a1a14, #10b981, #06b6d4);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
            animation: previewGlow 2s ease-in-out infinite;
        }

        @keyframes previewGlow {
            0%, 100% { box-shadow: 0 0 20px var(--glow-primary); }
            50% { box-shadow: 0 0 30px var(--glow-primary), 0 0 40px var(--glow-secondary); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -320px;
                z-index: 200;
                height: 100%;
                width: 320px;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .sidebar.collapsed {
                left: -320px;
            }
            
            .capabilities-grid {
                grid-template-columns: 1fr;
            }
            
            .theme-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .welcome-title {
                font-size: 36px;
            }

            .app-header {
                padding: 12px 20px;
            }

            .chat-messages {
                padding: 20px;
            }

            .input-container {
                padding: 16px 20px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 6px;
            border: 2px solid var(--bg-tertiary);
        }

        [data-theme^="neon"] ::-webkit-scrollbar-thumb,
        [data-theme="milky-way"] ::-webkit-scrollbar-thumb,
        [data-theme="cosmic-blue"] ::-webkit-scrollbar-thumb,
        [data-theme="solar-flare"] ::-webkit-scrollbar-thumb,
        [data-theme="aurora"] ::-webkit-scrollbar-thumb {
            box-shadow: 0 0 10px var(--glow-primary);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--accent));
        }

        /* Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

      

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 100px;
            right: 32px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-primary);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px var(--shadow-medium);
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-color: var(--success);
        }

        .notification.error {
            border-color: var(--error);
        }

        .notification.warning {
            border-color: var(--warning);
        }

        /* Export Modal */
        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .export-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .export-content {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            border: 2px solid var(--border-primary);
            transform: scale(0.8) translateY(50px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px var(--shadow-heavy);
        }

        .export-modal.active .export-content {
            transform: scale(1) translateY(0);
        }

        .export-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 24px;
        }

        .export-option {
            padding: 20px;
            border: 2px solid var(--border-primary);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: var(--bg-secondary);
        }

        .export-option:hover {
            border-color: var(--primary);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .export-option i {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        /* Share Modal */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .share-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .share-content {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            border: 2px solid var(--border-primary);
            transform: scale(0.8) translateY(50px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 60px var(--shadow-heavy);
        }

        .share-modal.active .share-content {
            transform: scale(1) translateY(0);
        }

        .share-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .share-option {
            padding: 20px;
            border: 2px solid var(--border-primary);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: var(--bg-secondary);
        }

        .share-option:hover {
            border-color: var(--primary);
            box-shadow: 0 8px 25px var(--glow-primary);
        }

        .share-option i {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .share-link {
            margin-top: 20px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-primary);
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
        }
    </style>
</head>
<body data-theme="light">
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Background Animation -->
    <div class="bg-animation"></div>
    
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <header class="app-header">
        <div class="logo-container">
            <button class="sidebar-toggle" id="sidebar-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">N</div>
            <div class="app-title">NeuroMed AI</div>
        </div>
        <div class="header-actions">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>AI Online</span>
            </div>
            <button class="action-btn" id="settings-btn" title="Settings">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </header>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <button class="new-chat-btn" id="new-chat-btn">
                    <i class="fas fa-plus"></i>
                    <span>New Analysis</span>
                </button>

                <div class="ai-stats">
                    <div class="ai-stats-title">AI Performance</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">99.2%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">1.2s</div>
                            <div class="stat-label">Response</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="analyzed-count">2.4k</div>
                            <div class="stat-label">Analyzed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">24/7</div>
                            <div class="stat-label">Available</div>
                        </div>
                    </div>
                </div>

                <div class="history-title">Recent Sessions</div>
                <div class="history-list" id="history-list">
                    <div class="history-item active">
                        <i class="fas fa-microscope"></i>
                        <span>Melanoma Detection</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-lungs"></i>
                        <span>Chest X-ray Analysis</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-pills"></i>
                        <span>Drug Interaction Check</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-brain"></i>
                        <span>MRI Brain Scan</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-heartbeat"></i>
                        <span>ECG Rhythm Analysis</span>
                    </div>
                    <div class="history-item">
                        <i class="fas fa-eye"></i>
                        <span>Retinal Screening</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-title">Advanced Medical AI Assistant</div>
                <div class="chat-actions">
                    <button class="chat-action-btn" id="export-btn">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button class="chat-action-btn" id="share-btn">
                        <i class="fas fa-share"></i> Share
                    </button>
                    <button class="chat-action-btn" id="save-btn">
                        <i class="fas fa-bookmark"></i> Save
                    </button>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="chat-messages" id="chat-messages">
                <!-- Welcome message when no conversation exists -->
                <div class="welcome-container" id="welcome-message">
                    <h1 class="welcome-title">NeuroMed AI Assistant</h1>
                    <p class="welcome-subtitle">Advanced multi-modal healthcare AI powered by cutting-edge neural networks. Upload medical images, describe symptoms, or ask questions for instant AI-powered medical insights.</p>
                    
                    <div class="capabilities-grid">
                        <div class="capability-card" data-prompt="Analyze this skin lesion for potential melanoma">
                            <div class="capability-icon">
                                <i class="fas fa-microscope"></i>
                            </div>
                            <div class="capability-title">Dermatology AI</div>
                            <div class="capability-desc">Advanced skin lesion analysis with 99.2% accuracy for melanoma detection</div>
                        </div>
                        
                        <div class="capability-card" data-prompt="Review this chest X-ray for abnormalities">
                            <div class="capability-icon">
                                <i class="fas fa-lungs"></i>
                            </div>
                            <div class="capability-title">Radiology AI</div>
                            <div class="capability-desc">Comprehensive imaging analysis for pneumonia, COVID-19, and lung conditions</div>
                        </div>
                        
                        <div class="capability-card" data-prompt="Check drug interactions and side effects">
                            <div class="capability-icon">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div class="capability-title">Pharmacy AI</div>
                            <div class="capability-desc">Real-time medication analysis, interactions, and personalized recommendations</div>
                        </div>
                        
                        <div class="capability-card" data-prompt="Analyze this brain MRI for abnormalities">
                            <div class="capability-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="capability-title">Neurology AI</div>
                            <div class="capability-desc">Advanced brain imaging analysis for tumors, strokes, and neurological conditions</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Container -->
            <div class="input-container">
                <div class="input-box">
                    <textarea 
                        class="text-input" 
                        id="message-input" 
                        placeholder="Describe symptoms, upload medical images, or ask any healthcare question..." 
                        rows="1"
                    ></textarea>
                    <div class="input-actions">
                        <button class="file-btn" id="file-btn" title="Upload medical image">
                            <i class="fas fa-image"></i>
                        </button>
                        <button class="voice-btn" id="voice-btn" title="Voice input">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="send-btn" id="send-btn" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h2 class="settings-title">System Settings</h2>
                <button class="close-btn" id="close-settings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">Visual Theme</label>
                <div class="theme-grid">
                    <div class="theme-option active" data-theme="light">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Light</div>
                    </div>
                    <div class="theme-option" data-theme="dark">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Dark</div>
                    </div>
                    <div class="theme-option" data-theme="neon-cyan">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Cyber Cyan</div>
                    </div>
                    <div class="theme-option" data-theme="neon-magenta">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Cyber Magenta</div>
                    </div>
                    <div class="theme-option" data-theme="neon-green">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Matrix Green</div>
                    </div>
                    <div class="theme-option" data-theme="neon-purple">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Royal Purple</div>
                    </div>
                    <div class="theme-option" data-theme="neon-orange">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Cyber Orange</div>
                    </div>
                    <div class="theme-option" data-theme="milky-way">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Milky Way</div>
                    </div>
                    <div class="theme-option" data-theme="cosmic-blue">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Cosmic Blue</div>
                    </div>
                    <div class="theme-option" data-theme="solar-flare">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Solar Flare</div>
                    </div>
                    <div class="theme-option" data-theme="aurora">
                        <div class="theme-preview"></div>
                        <div class="theme-name">Aurora</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="export-modal" id="export-modal">
        <div class="export-content">
            <div class="settings-header">
                <h2 class="settings-title">Export Chat</h2>
                <button class="close-btn" id="close-export">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="export-options">
                <div class="export-option" data-format="json">
                    <i class="fas fa-code"></i>
                    <div>JSON</div>
                    <div style="font-size: 12px; color: var(--text-tertiary);">Raw data format</div>
                </div>
                <div class="export-option" data-format="pdf">
                    <i class="fas fa-file-pdf"></i>
                    <div>PDF</div>
                    <div style="font-size: 12px; color: var(--text-tertiary);">Formatted document</div>
                </div>
                <div class="export-option" data-format="txt">
                    <i class="fas fa-file-alt"></i>
                    <div>Text</div>
                    <div style="font-size: 12px; color: var(--text-tertiary);">Plain text format</div>
                </div>
                <div class="export-option" data-format="html">
                    <i class="fas fa-code"></i>
                    <div>HTML</div>
                    <div style="font-size: 12px; color: var(--text-tertiary);">Web format</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="share-modal" id="share-modal">
        <div class="share-content">
            <div class="settings-header">
                <h2 class="settings-title">Share Chat</h2>
                <button class="close-btn" id="close-share">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="share-options">
                <div class="share-option" data-platform="link">
                    <i class="fas fa-link"></i>
                    <div>Copy Link</div>
                </div>
                <div class="share-option" data-platform="email">
                    <i class="fas fa-envelope"></i>
                    <div>Email</div>
                </div>
                <div class="share-option" data-platform="twitter">
                    <i class="fab fa-twitter"></i>
                    <div>Twitter</div>
                </div>
            </div>
            
            <div class="share-link" id="share-link" style="display: none;">
                <div style="margin-bottom: 8px; font-weight: 600;">Share Link:</div>
                <div id="share-url"></div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification" id="notification">
        <div class="notification-content"></div>
    </div>

    <script>
        // DOM Elements
        const loadingOverlay = document.getElementById('loading-overlay');
        const particlesContainer = document.getElementById('particles');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettings = document.getElementById('close-settings');
        const exportBtn = document.getElementById('export-btn');
        const exportModal = document.getElementById('export-modal');
        const closeExport = document.getElementById('close-export');
        const shareBtn = document.getElementById('share-btn');
        const shareModal = document.getElementById('share-modal');
        const closeShare = document.getElementById('close-share');
        const saveBtn = document.getElementById('save-btn');
        const newChatBtn = document.getElementById('new-chat-btn');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const fileBtn = document.getElementById('file-btn');
        const voiceBtn = document.getElementById('voice-btn');
        const chatMessages = document.getElementById('chat-messages');
        const welcomeMessage = document.getElementById('welcome-message');
        const historyList = document.getElementById('history-list');
        const capabilityCards = document.querySelectorAll('.capability-card');
        const themeOptions = document.querySelectorAll('.theme-option');
        const notification = document.getElementById('notification');
        const exportOptions = document.querySelectorAll('.export-option');
        const shareOptions = document.querySelectorAll('.share-option');
        const shareLink = document.getElementById('share-link');
        const shareUrl = document.getElementById('share-url');
        const analyzedCount = document.getElementById('analyzed-count');

        // State
        let currentTheme = localStorage.getItem('theme') || 'light';
        let sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        let currentChat = JSON.parse(localStorage.getItem('currentChat') || '[]');
        let savedChats = JSON.parse(localStorage.getItem('savedChats') || '[]');
        let messageLikes = JSON.parse(localStorage.getItem('messageLikes') || '{}');
        let totalAnalyzed = parseInt(localStorage.getItem('totalAnalyzed') || '2400');
        let isTyping = false;
        let messageIdCounter = parseInt(localStorage.getItem('messageIdCounter') || '0');
        
        // Initialize
        function init() {
            // Hide loading overlay
            setTimeout(() => {
                loadingOverlay.style.opacity = '0';
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                }, 500);
            }, 1500);

            // Create floating particles
            createParticles();
            
            // Set theme
            setTheme(currentTheme);
            
            // Set sidebar state
            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                sidebarToggle.classList.add('active');
            }
            
            // Update stats
            updateStats();
            
            // Set up event listeners
            setupEventListeners();
            
            // Load current chat
            loadCurrentChat();

            // Show welcome notification
            showNotification('NeuroMed AI System Online', 'success');
        }

        // Create floating particles
        function createParticles() {
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Update stats
        function updateStats() {
            analyzedCount.textContent = formatNumber(totalAnalyzed);
        }

        // Format number for display
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'k';
            }
            return num.toString();
        }
        
        // Event Listeners
        function setupEventListeners() {
            // Toggle sidebar
            sidebarToggle.addEventListener('click', toggleSidebar);
            
            // Settings modal
            settingsBtn.addEventListener('click', openSettings);
            closeSettings.addEventListener('click', closeSettingsModal);
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) closeSettingsModal();
            });

            // Export modal
            exportBtn.addEventListener('click', openExportModal);
            closeExport.addEventListener('click', closeExportModal);
            exportModal.addEventListener('click', (e) => {
                if (e.target === exportModal) closeExportModal();
            });

            // Share modal
            shareBtn.addEventListener('click', openShareModal);
            closeShare.addEventListener('click', closeShareModal);
            shareModal.addEventListener('click', (e) => {
                if (e.target === shareModal) closeShareModal();
            });

            // Save button
            saveBtn.addEventListener('click', saveCurrentChat);
            
            // Theme selection
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const theme = option.dataset.theme;
                    setTheme(theme);
                    updateThemeSelection(theme);
                    showNotification(`Theme changed to ${option.querySelector('.theme-name').textContent}`, 'success');
                });
            });

            // Export options
            exportOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const format = option.dataset.format;
                    exportChat(format);
                    closeExportModal();
                });
            });

            // Share options
            shareOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const platform = option.dataset.platform;
                    shareChat(platform);
                });
            });
            
            // Start new chat
            newChatBtn.addEventListener('click', startNewChat);
            
            // Handle message input
            messageInput.addEventListener('input', handleInputChange);
            messageInput.addEventListener('keydown', handleKeyDown);
            
            // Send message
            sendBtn.addEventListener('click', sendMessage);
            
            // Upload image
            fileBtn.addEventListener('click', () => {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'image/png, image/jpeg, image/jpg, image/webp';
                fileInput.onchange = handleImageUpload;
                fileInput.click();
            });
            
            // Voice input
            voiceBtn.addEventListener('click', toggleVoiceInput);
            
            // Capability cards
            capabilityCards.forEach(card => {
                card.addEventListener('click', () => {
                    const prompt = card.getAttribute('data-prompt');
                    messageInput.value = prompt;
                    sendBtn.disabled = false;
                    messageInput.focus();
                });
            });
            
            // History items
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.history-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    item.classList.add('active');
                    showNotification('Session loaded', 'success');
                });
            });

            // Close modals on outside click
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 && 
                    !sidebar.contains(e.target) && 
                    !sidebarToggle.contains(e.target) &&
                    sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'k':
                            e.preventDefault();
                            messageInput.focus();
                            break;
                        case 'n':
                            e.preventDefault();
                            startNewChat();
                            break;
                        case ',':
                            e.preventDefault();
                            openSettings();
                            break;
                        case 's':
                            e.preventDefault();
                            saveCurrentChat();
                            break;
                        case 'e':
                            e.preventDefault();
                            openExportModal();
                            break;
                    }
                }
            });
        }
        
        // Toggle sidebar
        function toggleSidebar() {
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                sidebarToggle.classList.toggle('active');
                sidebarCollapsed = sidebar.classList.contains('collapsed');
                localStorage.setItem('sidebarCollapsed', sidebarCollapsed);
            }
        }
        
        // Theme management
        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            currentTheme = theme;
            localStorage.setItem('theme', theme);
        }
        
        function updateThemeSelection(selectedTheme) {
            themeOptions.forEach(option => {
                option.classList.toggle('active', option.dataset.theme === selectedTheme);
            });
        }
        
        // Modal management
        function openSettings() {
            settingsModal.classList.add('active');
            updateThemeSelection(currentTheme);
        }
        
        function closeSettingsModal() {
            settingsModal.classList.remove('active');
        }

        function openExportModal() {
            if (currentChat.length === 0) {
                showNotification('No conversation to export', 'warning');
                return;
            }
            exportModal.classList.add('active');
        }

        function closeExportModal() {
            exportModal.classList.remove('active');
        }

        function openShareModal() {
            if (currentChat.length === 0) {
                showNotification('No conversation to share', 'warning');
                return;
            }
            shareModal.classList.add('active');
            shareLink.style.display = 'none';
        }

        function closeShareModal() {
            shareModal.classList.remove('active');
        }
        
        // Chat management
        function startNewChat() {
            // Save current chat if it has messages
            if (currentChat.length > 0) {
                saveCurrentChat();
            }

            currentChat = [];
            chatMessages.innerHTML = '';
            welcomeMessage.style.display = 'block';
            messageInput.value = '';
            sendBtn.disabled = true;
            
            // Clear active history item
            document.querySelectorAll('.history-item').forEach(item => {
                item.classList.remove('active');
            });

            // Save empty chat state
            localStorage.setItem('currentChat', JSON.stringify(currentChat));

            showNotification('New analysis session started', 'success');
        }

        function saveCurrentChat() {
            if (currentChat.length === 0) {
                showNotification('No conversation to save', 'warning');
                return;
            }

            const chatData = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                messages: currentChat,
                title: generateChatTitle(currentChat[0]?.text || 'Medical Consultation')
            };

            savedChats.unshift(chatData);
            
            // Keep only last 50 saved chats
            if (savedChats.length > 50) {
                savedChats = savedChats.slice(0, 50);
            }

            localStorage.setItem('savedChats', JSON.stringify(savedChats));
            showNotification('Conversation saved successfully', 'success');
        }

        function generateChatTitle(firstMessage) {
            const words = firstMessage.split(' ').slice(0, 5);
            return words.join(' ') + (firstMessage.split(' ').length > 5 ? '...' : '');
        }

        function loadCurrentChat() {
            if (currentChat.length > 0) {
                welcomeMessage.style.display = 'none';
                currentChat.forEach(msg => {
                    addMessageToDOM(msg.sender, msg.name, msg.text, msg.id, false);
                });
            }
        }
        
        // Input handling
        function handleInputChange() {
            // Auto-resize textarea
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 200) + 'px';
            
            // Enable/disable send button
            sendBtn.disabled = messageInput.value.trim() === '';
        }
        
        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!sendBtn.disabled) {
                    sendMessage();
                }
            }
        }
        
        // Message handling
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isTyping) return;

            const messageId = ++messageIdCounter;
            localStorage.setItem('messageIdCounter', messageIdCounter);

            // Add user message
            addMessage('user', 'You', message, messageId);

            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            sendBtn.disabled = true;

            // Hide welcome message
            welcomeMessage.style.display = 'none';

            // Show typing indicator
            showTypingIndicator();

            // Update analyzed count
            totalAnalyzed++;
            localStorage.setItem('totalAnalyzed', totalAnalyzed);
            updateStats();

            // Simulate AI response with realistic delay
            setTimeout(() => {
                hideTypingIndicator();
                const aiMessageId = ++messageIdCounter;
                localStorage.setItem('messageIdCounter', messageIdCounter);
                const aiResponse = generateAIResponse(message);
                addMessage('ai', 'NeuroMed AI', aiResponse, aiMessageId);
            }, 1500 + Math.random() * 1000);
        }
        
        function addMessage(sender, name, text, messageId, saveToStorage = true) {
            const messageData = { sender, name, text, id: messageId, timestamp: new Date().toISOString() };
            
            if (saveToStorage) {
                currentChat.push(messageData);
                localStorage.setItem('currentChat', JSON.stringify(currentChat));
            }

            addMessageToDOM(sender, name, text, messageId, true);
        }

        function addMessageToDOM(sender, name, text, messageId, animate = true) {
            // Create message element
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}`;
            messageEl.dataset.messageId = messageId;
            
            // Create avatar
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = sender === 'user' ? 'U' : 'N';
            
            // Create content container
            const content = document.createElement('div');
            content.className = 'message-content';
            
            // Create username
            const username = document.createElement('div');
            username.className = 'username';
            username.textContent = name;
            
            // Create message text
            const messageText = document.createElement('div');
            messageText.className = 'message-text';
            messageText.textContent = text;
            
            // Create actions
            const actions = document.createElement('div');
            actions.className = 'message-actions';
            
            if (sender === 'ai') {
                const likes = messageLikes[messageId] || { likes: 0, dislikes: 0, userAction: null };
                
                actions.innerHTML = `
                    <span class="action-icon copy-btn" title="Copy response"><i class="fas fa-copy"></i></span>
                    <span class="action-icon regen-btn" title="Regenerate"><i class="fas fa-redo"></i></span>
                    <span class="action-icon like-btn ${likes.userAction === 'like' ? 'liked' : ''}" title="Like" data-message-id="${messageId}">
                        <i class="fas fa-thumbs-up"></i>
                        <span class="like-count">${likes.likes}</span>
                    </span>
                    <span class="action-icon dislike-btn ${likes.userAction === 'dislike' ? 'disliked' : ''}" title="Dislike" data-message-id="${messageId}">
                        <i class="fas fa-thumbs-down"></i>
                        <span class="like-count">${likes.dislikes}</span>
                    </span>
                    <span class="action-icon share-msg-btn" title="Share message"><i class="fas fa-share"></i></span>
                `;
                
                // Add action functionality
                const copyBtn = actions.querySelector('.copy-btn');
                const regenBtn = actions.querySelector('.regen-btn');
                const likeBtn = actions.querySelector('.like-btn');
                const dislikeBtn = actions.querySelector('.dislike-btn');
                const shareMsgBtn = actions.querySelector('.share-msg-btn');
                
                copyBtn.addEventListener('click', () => {
                    navigator.clipboard.writeText(text);
                    showNotification('Response copied to clipboard', 'success');
                });

                regenBtn.addEventListener('click', () => {
                    const userMessage = findPreviousUserMessage(messageId);
                    if (userMessage) {
                        messageText.textContent = generateAIResponse(userMessage.text);
                        showNotification('Response regenerated', 'success');
                    }
                });

                likeBtn.addEventListener('click', () => handleLikeDislike(messageId, 'like'));
                dislikeBtn.addEventListener('click', () => handleLikeDislike(messageId, 'dislike'));
                
                shareMsgBtn.addEventListener('click', () => {
                    shareMessage(text);
                });
            }
            
            // Assemble the message
            content.appendChild(username);
            content.appendChild(messageText);
            content.appendChild(actions);
            
            messageEl.appendChild(avatar);
            messageEl.appendChild(content);
            
            // Add to chat
            chatMessages.appendChild(messageEl);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function findPreviousUserMessage(aiMessageId) {
            for (let i = currentChat.length - 1; i >= 0; i--) {
                if (currentChat[i].id < aiMessageId && currentChat[i].sender === 'user') {
                    return currentChat[i];
                }
            }
            return null;
        }

        function handleLikeDislike(messageId, action) {
            if (!messageLikes[messageId]) {
                messageLikes[messageId] = { likes: 0, dislikes: 0, userAction: null };
            }

            const likes = messageLikes[messageId];
            
            // Remove previous action
            if (likes.userAction === 'like') {
                likes.likes--;
            } else if (likes.userAction === 'dislike') {
                likes.dislikes--;
            }

            // Add new action if different
            if (likes.userAction !== action) {
                if (action === 'like') {
                    likes.likes++;
                } else {
                    likes.dislikes++;
                }
                likes.userAction = action;
            } else {
                likes.userAction = null;
            }

            // Update UI
            const messageEl = document.querySelector(`[data-message-id="${messageId}"]`);
            const likeBtn = messageEl.querySelector('.like-btn');
            const dislikeBtn = messageEl.querySelector('.dislike-btn');
            
            likeBtn.classList.toggle('liked', likes.userAction === 'like');
            dislikeBtn.classList.toggle('disliked', likes.userAction === 'dislike');
            
            likeBtn.querySelector('.like-count').textContent = likes.likes;
            dislikeBtn.querySelector('.like-count').textContent = likes.dislikes;

            // Save to localStorage
            localStorage.setItem('messageLikes', JSON.stringify(messageLikes));

            showNotification(action === 'like' ? 'Response liked' : 'Response disliked', 'success');
        }
        
        // Typing indicator
        function showTypingIndicator() {
            isTyping = true;
            const typingEl = document.createElement('div');
            typingEl.className = 'message ai typing-message';
            typingEl.innerHTML = `
                <div class="avatar">N</div>
                <div class="message-content">
                    <div class="username">NeuroMed AI</div>
                    <div class="message-text">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingEl);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            isTyping = false;
            const typingMessage = document.querySelector('.typing-message');
            if (typingMessage) {
                typingMessage.remove();
            }
        }
        
        // File upload
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showNotification('File size too large. Please select an image under 10MB.', 'error');
                return;
            }

            const messageId = ++messageIdCounter;
            localStorage.setItem('messageIdCounter', messageIdCounter);

            // Add user message with image
            addMessage('user', 'You', ` Uploaded medical image: ${file.name}`, messageId);

            // Hide welcome message
            welcomeMessage.style.display = 'none';

            // Show typing indicator
            showTypingIndicator();

            // Update analyzed count
            totalAnalyzed++;
            localStorage.setItem('totalAnalyzed', totalAnalyzed);
            updateStats();

            // Simulate AI image analysis
            setTimeout(() => {
                hideTypingIndicator();
                const aiMessageId = ++messageIdCounter;
                localStorage.setItem('messageIdCounter', messageIdCounter);
                const aiResponse = generateImageAnalysisResponse(file.name);
                addMessage('ai', 'NeuroMed AI', aiResponse, aiMessageId);
                showNotification('Image analysis complete', 'success');
            }, 3000 + Math.random() * 2000);
        }
        
        // Voice input
        function toggleVoiceInput() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showNotification('Voice input not supported in this browser', 'error');
                return;
            }

            // Visual feedback for voice recording
            voiceBtn.style.color = 'var(--primary)';
            voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
            
            showNotification('Voice recording started...', 'success');

            // Simulate voice input
            setTimeout(() => {
                voiceBtn.style.color = '';
                voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                messageInput.value = "Voice input: I have a persistent cough and chest pain. Can you help analyze my symptoms?";
                sendBtn.disabled = false;
                showNotification('Voice input processed', 'success');
            }, 3000);
        }

        // Export functionality
        function exportChat(format) {
            const chatData = {
                title: 'NeuroMed AI Conversation',
                timestamp: new Date().toISOString(),
                messages: currentChat,
                theme: currentTheme,
                stats: {
                    totalMessages: currentChat.length,
                    totalAnalyzed: totalAnalyzed
                }
            };

            switch (format) {
                case 'json':
                    downloadFile(JSON.stringify(chatData, null, 2), 'neuromed-chat.json', 'application/json');
                    break;
                case 'txt':
                    const txtContent = formatChatAsText(chatData);
                    downloadFile(txtContent, 'neuromed-chat.txt', 'text/plain');
                    break;
                case 'html':
                    const htmlContent = formatChatAsHTML(chatData);
                    downloadFile(htmlContent, 'neuromed-chat.html', 'text/html');
                    break;
                case 'pdf':
                    generatePDF(chatData);
                    break;
            }

            showNotification(`Chat exported as ${format.toUpperCase()}`, 'success');
        }

        function formatChatAsText(chatData) {
            let content = `NeuroMed AI Conversation\n`;
            content += `Generated: ${new Date(chatData.timestamp).toLocaleString()}\n`;
            content += `Theme: ${chatData.theme}\n`;
            content += `Total Messages: ${chatData.stats.totalMessages}\n\n`;
            content += '=' * 50 + '\n\n';

            chatData.messages.forEach(msg => {
                content += `${msg.name} (${new Date(msg.timestamp).toLocaleString()}):\n`;
                content += `${msg.text}\n\n`;
            });

            return content;
        }

        function formatChatAsHTML(chatData) {
            let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroMed AI Conversation</title>
    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .message { margin-bottom: 20px; padding: 15px; border-radius: 10px; }
        .user { background: #e3f2fd; }
        .ai { background: #f3e5f5; }
        .username { font-weight: bold; margin-bottom: 5px; }
        .timestamp { font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>NeuroMed AI Conversation</h1>
        <p>Generated: ${new Date(chatData.timestamp).toLocaleString()}</p>
        <p>Theme: ${chatData.theme} | Messages: ${chatData.stats.totalMessages}</p>
    </div>`;

            chatData.messages.forEach(msg => {
                html += `
    <div class="message ${msg.sender}">
        <div class="username">${msg.name}</div>
        <div class="timestamp">${new Date(msg.timestamp).toLocaleString()}</div>
        <div class="text">${msg.text.replace(/\n/g, '<br>')}</div>
    </div>`;
            });

            html += `
</body>
</html>`;

            return html;
        }

        function generatePDF(chatData) {
            // For a real implementation, you would use a library like jsPDF
            // For now, we'll create a simple HTML version and suggest printing
            const htmlContent = formatChatAsHTML(chatData);
            const newWindow = window.open('', '_blank');
            newWindow.document.write(htmlContent);
            newWindow.document.close();
            
            setTimeout(() => {
                newWindow.print();
            }, 500);
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Share functionality
        function shareChat(platform) {
            const chatSummary = generateChatSummary();
            const shareText = `Check out my NeuroMed AI consultation: ${chatSummary}`;
            const shareUrl = generateShareUrl();

            switch (platform) {
                case 'link':
                    navigator.clipboard.writeText(shareUrl);
                    shareLink.style.display = 'block';
                    document.getElementById('share-url').textContent = shareUrl;
                    showNotification('Share link copied to clipboard', 'success');
                    break;
                case 'email':
                    const emailSubject = encodeURIComponent('NeuroMed AI Consultation');
                    const emailBody = encodeURIComponent(`${shareText}\n\nView full conversation: ${shareUrl}`);
                    window.open(`mailto:?subject=${emailSubject}&body=${emailBody}`);
                    break;
                case 'twitter':
                    const tweetText = encodeURIComponent(shareText);
                    window.open(`https://twitter.com/intent/tweet?text=${tweetText}&url=${encodeURIComponent(shareUrl)}`);
                    break;
            }
        }

        function shareMessage(messageText) {
            const shareText = `NeuroMed AI insight: ${messageText.substring(0, 200)}${messageText.length > 200 ? '...' : ''}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'NeuroMed AI Insight',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText);
                showNotification('Message copied to clipboard', 'success');
            }
        }

        function generateChatSummary() {
            if (currentChat.length === 0) return 'New consultation';
            const firstUserMessage = currentChat.find(msg => msg.sender === 'user');
            return firstUserMessage ? firstUserMessage.text.substring(0, 100) + '...' : 'Medical consultation';
        }

        function generateShareUrl() {
            // In a real app, this would generate a unique shareable URL
            const chatId = Date.now().toString(36);
            return `${window.location.origin}${window.location.pathname}?chat=${chatId}`;
        }
        
        // AI Response Generation
        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes("hello") || lowerMessage.includes("hi")) {
                return " Hello! I'm NeuroMed AI, your advanced healthcare assistant powered by cutting-edge neural networks. I'm equipped with state-of-the-art medical knowledge and can analyze images, symptoms, and provide comprehensive healthcare insights. How can I assist you today?";
            }
            
            if (lowerMessage.includes("skin") || lowerMessage.includes("lesion") || lowerMessage.includes("melanoma")) {
                return " **DERMATOLOGY ANALYSIS INITIATED**\n\nI'm ready to perform advanced skin lesion analysis using our proprietary melanoma detection algorithms. Please upload a high-resolution image of the affected area for comprehensive analysis.\n\n**Analysis Capabilities:**\n Melanoma risk assessment (99.2% accuracy)\n Benign vs. malignant classification\n ABCDE criteria evaluation\n Treatment recommendations\n Follow-up scheduling\n\n **Medical Disclaimer:** This analysis is for informational purposes only. Please consult a dermatologist for professional diagnosis.";
            }
            
            if (lowerMessage.includes("chest") || lowerMessage.includes("x-ray") || lowerMessage.includes("lung")) {
                return " **RADIOLOGY AI ACTIVATED**\n\nInitiating comprehensive chest imaging analysis protocol. Our advanced neural networks can detect:\n\n**Pathology Detection:**\n Pneumonia (bacterial/viral)\n COVID-19 indicators\n Tuberculosis markers\n Lung nodules/masses\n Pleural effusion\n Pneumothorax\n\n**Analysis Features:**\n Real-time processing\n Confidence scoring\n Comparative analysis\n Treatment recommendations\n\nPlease upload your chest X-ray in DICOM or standard image format for immediate analysis.";
            }
            
            if (lowerMessage.includes("medication") || lowerMessage.includes("drug") || lowerMessage.includes("pill")) {
                return " **PHARMACEUTICAL DATABASE ACCESSED**\n\nConnecting to comprehensive drug interaction database...\n\n**Available Services:**\n Drug interaction analysis\n Side effect profiling\n Dosage optimization\n Alternative medication suggestions\n Contraindication warnings\n Pharmacokinetic modeling\n\n**Database Stats:**\n 50,000+ medications\n 2M+ interaction pairs\n Real-time updates\n FDA-approved data\n\nPlease provide the medication name(s) or describe your condition for personalized pharmaceutical guidance.";
            }
            
            if (lowerMessage.includes("symptom") || lowerMessage.includes("pain") || lowerMessage.includes("diagnos")) {
                return " **SYMPTOM ANALYSIS ENGINE ONLINE**\n\nInitiating comprehensive symptom assessment protocol...\n\n**Assessment Parameters:**\n Symptom severity (1-10 scale)\n Duration and progression\n Associated symptoms\n Medical history correlation\n Risk factor analysis\n\n**Diagnostic Capabilities:**\n Differential diagnosis\n Probability scoring\n Urgency classification\n Treatment pathways\n Specialist referrals\n\nPlease provide detailed symptom information including onset, duration, severity, and any triggering factors for accurate analysis.";
            }

            if (lowerMessage.includes("brain") || lowerMessage.includes("mri") || lowerMessage.includes("neurolog")) {
                return " **NEUROLOGY AI SYSTEM ACTIVATED**\n\nAdvanced brain imaging analysis ready...\n\n**Neurological Analysis:**\n Tumor detection and classification\n Stroke identification\n Multiple sclerosis markers\n Alzheimer's indicators\n Traumatic brain injury assessment\n Vascular abnormalities\n\n**AI Capabilities:**\n 3D volumetric analysis\n Lesion segmentation\n Progression tracking\n Treatment planning\n\nUpload MRI, CT, or other neuroimaging for comprehensive analysis.";
            }
            
            return " **NEUROMED AI PROCESSING COMPLETE**\n\nI've analyzed your query using advanced medical algorithms and neural networks. Here's my comprehensive assessment:\n\n**Analysis Summary:**\n Query processed through 15+ medical databases\n Cross-referenced with latest research\n Personalized recommendations generated\n Risk factors evaluated\n\n**Available Services:**\n Medical image analysis\n Drug interaction checking\n Symptom assessment\n Genetic counseling\n Health monitoring\n\n**Next Steps:**\nPlease provide more specific details about your healthcare concern, upload relevant medical images, or ask about any of our specialized AI services for optimal assistance.\n\n*Powered by NeuroMed AI - Your trusted healthcare companion*";
        }

        function generateImageAnalysisResponse(filename) {
            const responses = [
                ` **ADVANCED IMAGE ANALYSIS COMPLETE**\n\nImage: ${filename}\n\n**AI Analysis Results:**\n High-resolution scan processed\n Neural network confidence: 94.7%\n Pathology detection: In progress\n Comparative analysis: Complete\n\n**Preliminary Findings:**\nThe uploaded image has been successfully processed through our advanced medical imaging AI. Detailed analysis reveals several key indicators that require professional medical evaluation.\n\n**Recommendations:**\n Schedule consultation with specialist\n Consider additional imaging if needed\n Monitor for changes\n Follow-up in 2-4 weeks\n\n **Important:** This AI analysis is for informational purposes only. Please consult with a qualified healthcare professional for proper diagnosis and treatment.`,
                
                ` **MEDICAL IMAGING AI REPORT**\n\nFile: ${filename}\nProcessing Time: 2.3 seconds\nAnalysis Confidence: 96.2%\n\n**Imaging Protocol:**\n Deep learning model: MedNet-V4\n Training dataset: 2.4M medical images\n Validation accuracy: 99.1%\n Real-time processing: Enabled\n\n**Analysis Summary:**\nComprehensive evaluation completed using state-of-the-art computer vision algorithms. The image quality is excellent for diagnostic purposes.\n\n**Clinical Insights:**\n Anatomical structures clearly visible\n No obvious artifacts detected\n Suitable for diagnostic interpretation\n Recommend professional review\n\n**Next Steps:**\nPlease share this analysis with your healthcare provider for clinical correlation and appropriate medical management.`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }
        
        // Notification system
        function showNotification(message, type = 'success') {
            const notificationContent = notification.querySelector('.notification-content') || notification;
            notificationContent.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Initialize app
        init();
    </script>
</body>
</html>

